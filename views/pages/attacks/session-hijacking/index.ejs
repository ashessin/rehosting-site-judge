<!DOCTYPE html>
<html lang="en">
<% include ../../../partials/head.ejs %>

<body>
<% include ../../../partials/nav.ejs %>
<main>
    <h1><%= title %></h1>
    <hr>
    <aside>
        <pre><%- JSON.stringify(parsedUrl, null, 2) %></pre>
    </aside>
    <kbd>navigator-cookies-enabled</kbd>
    <pre><code id="navigator-cookies-enabled"></code></pre>
    <kbd>can-access-client-cookie</kbd>
    <pre><code id="can-access-client-cookie"></code></pre>
    <kbd>can-access-http-only-cookie</kbd>
    <pre><code id="can-access-http-only-cookie"></code></pre>
    <kbd>request-cookies</kbd>
    <pre><code id="request-cookies"><%- JSON.stringify(requestCookies, null, 2) %></code></pre>
    <kbd>document-cookies</kbd>
    <pre><code id="document-cookies"></code></pre>
</main>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        function getCookies(tld) {
            const decodedCookie = decodeURIComponent(document.cookie);
            const cookies = Object.fromEntries(decodedCookie.split(';')
                .map(cookie => cookie.trim())
                .map(cookie => {
                    return [
                        cookie.split('=')[0],
                        cookie.split('=').slice(1).join('=')
                    ]
                }));
            if (tld !== "") {
                const tldCookies = Object.keys(cookies).filter(cookieKey => {
                    return cookieKey.indexOf(tld) > -1;
                });
                return tldCookies.reduce((a, e) => (a[e] = cookies[e], a), {});
            }
            return cookies
        }

        const clientCookie = getCookies("clientCookie")
        if (Object.keys(clientCookie).length === 0 && clientCookie.constructor === Object)
            document.getElementById('can-access-client-cookie').innerText = 'false'
        else
            document.getElementById('can-access-client-cookie').innerText = 'true'

        const httpOnlyCookie = getCookies("serverCookieHttpOnly")
        if (Object.keys(httpOnlyCookie).length === 0 && httpOnlyCookie.constructor === Object)
            document.getElementById('can-access-http-only-cookie').innerText = 'false'
        else
            document.getElementById('can-access-http-only-cookie').innerText = 'true'

        document.getElementById('document-cookies').innerText = JSON.stringify(getCookies(""), null, 2)
        document.getElementById('navigator-cookies-enabled').innerText = navigator.cookieEnabled.toString()
    })
</script>
</body>

</html>
